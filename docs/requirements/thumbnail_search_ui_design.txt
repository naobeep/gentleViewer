# ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆé€²æ—ãƒ»ä¿å­˜æ¸ˆã¿æ¤œç´¢ç®¡ç†UI è¨­è¨ˆæ›¸

## ç›®æ¬¡

1. [ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆé€²æ—UI](#1-ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆé€²æ—ui)
2. [ä¿å­˜æ¸ˆã¿æ¤œç´¢ç®¡ç†UI](#2-ä¿å­˜æ¸ˆã¿æ¤œç´¢ç®¡ç†ui)

---

## 1. ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆé€²æ—UI

### 1.1 æ¦‚è¦

ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å®Ÿè¡Œã•ã‚Œã‚‹ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆã®é€²æ—ã‚’è¦–è¦šçš„ã«è¡¨ç¤ºã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç¾åœ¨ã®å‡¦ç†çŠ¶æ³ã‚’ä¼ãˆã‚‹ã€‚

### 1.2 è¡¨ç¤ºä½ç½®

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼å³å´ï¼ˆå¸¸é§å‹ï¼‰**

```txt
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1,234ä»¶ä¸­ 45ä»¶é¸æŠ  åˆè¨ˆ: 2.3GB  [ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆä¸­ 15/120] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 çŠ¶æ…‹åˆ¥è¡¨ç¤º

#### 1.3.1 ç”Ÿæˆä¸­

```txt
[ğŸ”„ ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆä¸­ 15/120]
```

- ã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°ãƒ‘ãƒãƒ«ã‚’é–‹ã
- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¡¨ç¤º

#### 1.3.2 å®Œäº†

```txt
[âœ“ ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆå®Œäº†]
```

- 3ç§’å¾Œã«è‡ªå‹•ã§æ¶ˆãˆã‚‹
- ã‚¯ãƒªãƒƒã‚¯ã§å³åº§ã«éè¡¨ç¤º

#### 1.3.3 ã‚¨ãƒ©ãƒ¼

```txt
[âš  ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆã‚¨ãƒ©ãƒ¼]
```

- ã‚¯ãƒªãƒƒã‚¯ã§ã‚¨ãƒ©ãƒ¼è©³ç´°ã‚’è¡¨ç¤º

### 1.4 è©³ç´°ãƒ‘ãƒãƒ«

```txt
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆ                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚ é€²æ—: 15 / 120 ãƒ•ã‚¡ã‚¤ãƒ« (12.5%)                 â”‚
â”‚ [â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 12%  â”‚
â”‚                                                 â”‚
â”‚ å‡¦ç†ä¸­: manga_vol_15.zip                        â”‚
â”‚ æ®‹ã‚Šæ™‚é–“: ç´„ 2åˆ†30ç§’                            â”‚
â”‚                                                 â”‚
â”‚ æˆåŠŸ: 14                                        â”‚
â”‚ ã‚¹ã‚­ãƒƒãƒ—: 1 (ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ¸ˆã¿)                     â”‚
â”‚ ã‚¨ãƒ©ãƒ¼: 0                                        â”‚
â”‚                                                 â”‚
â”‚ [ä¸€æ™‚åœæ­¢] [ã‚­ãƒ£ãƒ³ã‚»ãƒ«] [ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å®Ÿè¡Œ]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.5 å®Ÿè£…

#### 1.5.1 å‹å®šç¾©

```typescript
interface ThumbnailGenerationProgress {
  total: number;
  completed: number;
  skipped: number;
  errors: number;
  currentFile: string | null;
  estimatedTimeRemaining: number | null; // ç§’
  status: 'idle' | 'running' | 'paused' | 'completed' | 'error';
}

interface ThumbnailError {
  filePath: string;
  fileName: string;
  error: string;
  timestamp: number;
}
```

#### 1.5.2 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```typescript
const ThumbnailProgressIndicator: React.FC = () => {
  const [progress, setProgress] = useState<ThumbnailGenerationProgress | null>(null);
  const [showDetail, setShowDetail] = useState(false);
  const [errors, setErrors] = useState<ThumbnailError[]>([]);

  // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°ã‚’è³¼èª­
  useEffect(() => {
    const unsubscribe = window.electronAPI.onThumbnailProgress((data) => {
      setProgress(data);
    });

    return unsubscribe;
  }, []);

  // ã‚¨ãƒ©ãƒ¼é€šçŸ¥ã‚’è³¼èª­
  useEffect(() => {
    const unsubscribe = window.electronAPI.onThumbnailError((error) => {
      setErrors(prev => [...prev, error]);
    });

    return unsubscribe;
  }, []);

  if (!progress || progress.status === 'idle') return null;

  const percentage = (progress.completed / progress.total) * 100;

  return (
    <>
      <div
        className="thumbnail-progress-indicator"
        onClick={() => setShowDetail(true)}
      >
        {progress.status === 'running' && (
          <>
            <SpinnerIcon className="rotating" size={16} />
            <span>ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆä¸­ {progress.completed}/{progress.total}</span>
          </>
        )}
        {progress.status === 'completed' && (
          <>
            <CheckIcon size={16} />
            <span>ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆå®Œäº†</span>
          </>
        )}
        {progress.status === 'error' && (
          <>
            <AlertIcon size={16} />
            <span>ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆã‚¨ãƒ©ãƒ¼</span>
          </>
        )}
      </div>

      {showDetail && (
        <ThumbnailProgressDetail
          progress={progress}
          errors={errors}
          onClose={() => setShowDetail(false)}
        />
      )}
    </>
  );
};

const ThumbnailProgressDetail: React.FC<{
  progress: ThumbnailGenerationProgress;
  errors: ThumbnailError[];
  onClose: () => void;
}> = ({ progress, errors, onClose }) => {
  const percentage = (progress.completed / progress.total) * 100;

  const handlePause = async () => {
    await window.electronAPI.pauseThumbnailGeneration();
  };

  const handleResume = async () => {
    await window.electronAPI.resumeThumbnailGeneration();
  };

  const handleCancel = async () => {
    await window.electronAPI.cancelThumbnailGeneration();
    onClose();
  };

  return (
    <div className="thumbnail-progress-detail">
      <div className="detail-header">
        <h3>ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆ</h3>
        <button onClick={onClose}>Ã—</button>
      </div>

      <div className="detail-content">
        <div className="progress-info">
          <p>é€²æ—: {progress.completed} / {progress.total} ãƒ•ã‚¡ã‚¤ãƒ« ({percentage.toFixed(1)}%)</p>
          <div className="progress-bar">
            <div
              className="progress-fill"
              style={{ width: `${percentage}%` }}
            />
          </div>
        </div>

        {progress.currentFile && (
          <div className="current-file">
            <p className="label">å‡¦ç†ä¸­:</p>
            <p className="value">{progress.currentFile}</p>
          </div>
        )}

        {progress.estimatedTimeRemaining && (
          <div className="time-remaining">
            <p>æ®‹ã‚Šæ™‚é–“: ç´„ {formatDuration(progress.estimatedTimeRemaining)}</p>
          </div>
        )}

        <div className="stats-grid">
          <div className="stat-item">
            <span className="label">æˆåŠŸ</span>
            <span className="value success">{progress.completed - progress.errors}</span>
          </div>
          <div className="stat-item">
            <span className="label">ã‚¹ã‚­ãƒƒãƒ—</span>
            <span className="value">{progress.skipped}</span>
          </div>
          <div className="stat-item">
            <span className="label">ã‚¨ãƒ©ãƒ¼</span>
            <span className="value error">{progress.errors}</span>
          </div>
        </div>

        {errors.length > 0 && (
          <div className="error-list">
            <h4>ã‚¨ãƒ©ãƒ¼ ({errors.length}ä»¶)</h4>
            <div className="error-items">
              {errors.slice(0, 5).map((error, index) => (
                <div key={index} className="error-item">
                  <AlertIcon size={16} />
                  <span>{error.fileName}</span>
                  <span className="error-message">{error.error}</span>
                </div>
              ))}
              {errors.length > 5 && (
                <p className="more-errors">ä»– {errors.length - 5} ä»¶ã®ã‚¨ãƒ©ãƒ¼</p>
              )}
            </div>
          </div>
        )}
      </div>

      <div className="detail-footer">
        {progress.status === 'running' ? (
          <button onClick={handlePause}>ä¸€æ™‚åœæ­¢</button>
        ) : progress.status === 'paused' ? (
          <button onClick={handleResume}>å†é–‹</button>
        ) : null}
        <button onClick={handleCancel}>ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button className="primary" onClick={onClose}>
          ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å®Ÿè¡Œ
        </button>
      </div>
    </div>
  );
};
```

#### 1.5.3 ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹å®Ÿè£…

```typescript
// main/services/thumbnail-generator.ts
import { EventEmitter } from 'events';
import path from 'path';
import fs from 'fs/promises';
import pLimit from 'p-limit';
import { ThumbnailGenerationProgress, ThumbnailError } from '../../src/shared/types/thumbnail';

const sleep = (ms: number) => new Promise((r) => setTimeout(r, ms));

class ThumbnailGenerator extends EventEmitter {
  private queue: string[] = [];
  private isRunning = false;
  private isPaused = false;
  private limit = pLimit(3); // åŒæ™‚3ãƒ•ã‚¡ã‚¤ãƒ«

  private progress: ThumbnailGenerationProgress = {
    total: 0,
    completed: 0,
    skipped: 0,
    errors: 0,
    currentFile: null,
    estimatedTimeRemaining: null,
    status: 'idle',
  };

  async generateThumbnails(filePaths: string[]) {
    if (!filePaths || filePaths.length === 0) return;
    this.queue = [...filePaths];
    this.progress.total = filePaths.length;
    this.progress.completed = 0;
    this.progress.skipped = 0;
    this.progress.errors = 0;
    this.progress.status = 'running';
    this.isRunning = true;

    const startTime = Date.now();

    try {
      const tasks = this.queue.map((filePath) =>
        this.limit(async () => {
          if (!this.isRunning) return;

          while (this.isPaused) {
            await sleep(100);
          }

          this.progress.currentFile = path.basename(filePath);
          this.emitProgress();

          try {
            const exists = await this.checkCachedThumbnail(filePath);
            if (exists) {
              this.progress.skipped++;
            } else {
              await this.generateSingleThumbnail(filePath);
            }
            this.progress.completed++;
          } catch (err) {
            this.progress.errors++;
            const errorObj: ThumbnailError = {
              filePath,
              fileName: path.basename(filePath),
              error: err instanceof Error ? err.message : String(err),
              timestamp: Date.now(),
            };
            this.emit('error', errorObj);
          }

          const elapsed = Date.now() - startTime;
          const rate = elapsed > 0 ? this.progress.completed / elapsed : 0;
          const remaining = this.progress.total - this.progress.completed;
          this.progress.estimatedTimeRemaining = rate > 0 ? Math.ceil((remaining / rate) / 1000) : null;

          this.emitProgress();
        })
      );

      await Promise.all(tasks);

      if (this.isRunning) {
        this.progress.status = 'completed';
        this.progress.currentFile = null;
        this.emitProgress();

        // è‡ªå‹•çš„ã« idle ã«æˆ»ã—ãŸã„å ´åˆã¯ã“ã“ã§ãƒªã‚»ãƒƒãƒˆã—ã¦ã‚‚è‰¯ã„
        this.isRunning = false;
      }
    } catch (error) {
      this.progress.status = 'error';
      this.emitProgress();
      this.isRunning = false;
    }
  }

  pause() {
    this.isPaused = true;
    this.progress.status = 'paused';
    this.emitProgress();
  }

  resume() {
    this.isPaused = false;
    this.progress.status = 'running';
    this.emitProgress();
  }

  cancel() {
    this.isRunning = false;
    this.queue = [];
    this.progress.status = 'idle';
    this.progress.currentFile = null;
    this.emitProgress();
  }

  private emitProgress() {
    // progress ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ã‚³ãƒ”ãƒ¼ã—ã¦é€ã‚‹
    this.emit('progress', { ...this.progress });
  }

  private async generateSingleThumbnail(filePath: string): Promise<void> {
    // å®Ÿé‹ç”¨ã§ã¯ã“ã“ã‚’ sharp ç­‰ã§å®Ÿè£…ã™ã‚‹
    // ã“ã“ã§ã¯ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ã¨ã—ã¦çŸ­æ™‚é–“å¾…æ©Ÿã—ã¦ãƒ€ãƒŸãƒ¼thumbã‚’ä½œæˆã™ã‚‹
    const thumbsDir = path.join(path.dirname(filePath), '.gentle_thumbs');
    try {
      await fs.mkdir(thumbsDir, { recursive: true });
      await sleep(300 + Math.random() * 700); // æ“¬ä¼¼å‡¦ç†æ™‚é–“
      const thumbPath = path.join(thumbsDir, path.basename(filePath) + '.thumb');
      await fs.writeFile(thumbPath, 'thumbnail'); // å®Ÿé‹ç”¨ã§ã¯ç”»åƒãƒ‡ãƒ¼ã‚¿
    } catch (e) {
      throw e;
    }
  }

  private async checkCachedThumbnail(filePath: string): Promise<boolean> {
    const thumbsDir = path.join(path.dirname(filePath), '.gentle_thumbs');
    const thumbPath = path.join(thumbsDir, path.basename(filePath) + '.thumb');
    try {
      await fs.access(thumbPath);
      return true;
    } catch {
      return false;
    }
  }
}

export const thumbnailGenerator = new ThumbnailGenerator();
```

---

## 2. ä¿å­˜æ¸ˆã¿æ¤œç´¢ç®¡ç†UI

### 2.1 æ¦‚è¦

ã‚ˆãä½¿ã†æ¤œç´¢æ¡ä»¶ã‚’ä¿å­˜ãƒ»ç®¡ç†ã—ã€ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§å†æ¤œç´¢ã§ãã‚‹æ©Ÿèƒ½ã€‚

### 2.2 è¡¨ç¤ºä½ç½®

ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ã€Œã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…

```txt
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹]         â”‚
â”‚  ğŸ“ æœ€è¿‘è¿½åŠ                â”‚
â”‚  â­ ãŠæ°—ã«å…¥ã‚Š             â”‚
â”‚  ğŸ”– ä¿å­˜æ¸ˆã¿æ¤œç´¢           â”‚ â† ã“ã“
â”‚  ğŸ“Š çµ±è¨ˆ                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 ä¿å­˜æ¸ˆã¿æ¤œç´¢ãƒ‘ãƒãƒ«

```txt
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¿å­˜æ¸ˆã¿æ¤œç´¢                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [+ æ–°è¦ä¿å­˜]                [âš™ç®¡ç†]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ â­ æœªèª­æ¼«ç”»                              â”‚
â”‚    ã‚¿ã‚°: æ¼«ç”» AND æœªèª­                   â”‚
â”‚    15ä»¶                                 â”‚
â”‚                                         â”‚
â”‚ ğŸ“º é•·ç·¨å‹•ç”»                              â”‚
â”‚    ã‚¿ã‚°: å‹•ç”», é•·ã•: 30åˆ†ä»¥ä¸Š            â”‚
â”‚    8ä»¶                                  â”‚
â”‚                                         â”‚
â”‚ ğŸ“š æŠ€è¡“æ›¸PDF                             â”‚
â”‚    ã‚¿ã‚°: PDF AND æŠ€è¡“æ›¸                  â”‚
â”‚    42ä»¶                                 â”‚
â”‚                                         â”‚
â”‚ ğŸ¨ ã‚¤ãƒ©ã‚¹ãƒˆé›†ï¼ˆé«˜è§£åƒåº¦ï¼‰                 â”‚
â”‚    ã‚¿ã‚°: ã‚¤ãƒ©ã‚¹ãƒˆ, è§£åƒåº¦: 1920x1080ä»¥ä¸Š  â”‚
â”‚    127ä»¶                                â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 ä¿å­˜ãƒ€ã‚¤ã‚¢ãƒ­ã‚°

```txt
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¤œç´¢æ¡ä»¶ã‚’ä¿å­˜                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ æ¤œç´¢å: [___________________________]   â”‚
â”‚                                         â”‚
â”‚ ç¾åœ¨ã®æ¤œç´¢æ¡ä»¶:                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ã‚¿ã‚°: æ¼«ç”», å®Œçµ                     â”‚ â”‚
â”‚ â”‚ ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼: ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–             â”‚ â”‚
â”‚ â”‚ ãƒšãƒ¼ã‚¸æ•°: 20ã€œ100                    â”‚ â”‚
â”‚ â”‚ æ›´æ–°æ—¥: éå»7æ—¥é–“                    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚ â˜‘ ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ                        â”‚
â”‚ â˜ ã‚µã‚¤ãƒ‰ãƒãƒ¼ã«å›ºå®šè¡¨ç¤º                   â”‚
â”‚                                         â”‚
â”‚ ã‚¢ã‚¤ã‚³ãƒ³: [ğŸ“šâ–¾]                         â”‚
â”‚                                         â”‚
â”‚ [ã‚­ãƒ£ãƒ³ã‚»ãƒ«]              [ä¿å­˜]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.5 ç®¡ç†ç”»é¢

```txt
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¿å­˜æ¸ˆã¿æ¤œç´¢ã®ç®¡ç†                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [æ¤œç´¢: ____________] [ä¸¦ã³é †: åå‰é †â–¾] [+ æ–°è¦ä½œæˆ]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚ â˜‘ â­ æœªèª­æ¼«ç”»                                     [ç·¨é›†] â”‚
â”‚    ã‚¿ã‚°: æ¼«ç”» AND æœªèª­                                   â”‚
â”‚    ä½œæˆ: 2025-09-15  æœ€çµ‚å®Ÿè¡Œ: 2025-10-05              â”‚
â”‚    å®Ÿè¡Œå›æ•°: 42å›                                       â”‚
â”‚                                                         â”‚
â”‚ â˜‘ ğŸ“º é•·ç·¨å‹•ç”»                                     [ç·¨é›†] â”‚
â”‚    ã‚¿ã‚°: å‹•ç”», é•·ã•: 30åˆ†ä»¥ä¸Š                            â”‚
â”‚    ä½œæˆ: 2025-09-20  æœ€çµ‚å®Ÿè¡Œ: 2025-10-03              â”‚
â”‚    å®Ÿè¡Œå›æ•°: 18å›                                       â”‚
â”‚                                                         â”‚
â”‚ â˜ ğŸ“š æŠ€è¡“æ›¸PDF                                    [ç·¨é›†] â”‚
â”‚    ã‚¿ã‚°: PDF AND æŠ€è¡“æ›¸                                  â”‚
â”‚    ä½œæˆ: 2025-08-10  æœ€çµ‚å®Ÿè¡Œ: 2025-09-28              â”‚
â”‚    å®Ÿè¡Œå›æ•°: 5å›                                        â”‚
â”‚                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é¸æŠ: 2ä»¶                                               â”‚
â”‚ [å‰Šé™¤] [ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ] [ã‚¤ãƒ³ãƒãƒ¼ãƒˆ]           [é–‰ã˜ã‚‹]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.6 å®Ÿè£…

#### 2.6.1 å‹å®šç¾©

```typescript
interface SavedSearch {
  id: string;
  name: string;
  icon: string;
  query: SearchQuery;
  isFavorite: boolean;
  isPinned: boolean;
  createdAt: Date;
  lastExecuted: Date | null;
  executionCount: number;
}

interface SearchQuery {
  tags: {
    include: number[];
    exclude: number[];
    any: number[];
  };
  fileTypes: string[];
  filename?: string;
  dateRange?: [Date, Date];
  sizeRange?: [number, number];
  // å½¢å¼å›ºæœ‰ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
  archivePageRange?: [number, number];
  durationRange?: [number, number];
  resolutionMin?: { width: number; height: number };
}
```

#### 2.6.2 ä¿å­˜æ¸ˆã¿æ¤œç´¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```typescript
const SavedSearchesPanel: React.FC<{
  isOpen: boolean;
  onClose: () => void;
}> = ({ isOpen, onClose }) => {
  const [searches, setSearches] = useState<SavedSearch[]>([]);
  const [showSaveDialog, setShowSaveDialog] = useState(false);
  const [showManageDialog, setShowManageDialog] = useState(false);

  useEffect(() => {
    const loadSearches = async () => {
      const data = await window.electronAPI.getSavedSearches();
      setSearches(data);
    };
    loadSearches();
  }, []);

  const handleExecute = async (search: SavedSearch) => {
    await window.electronAPI.executeSearch(search.query);
    await window.electronAPI.updateSearchExecutionCount(search.id);

    // å®Ÿè¡Œå›æ•°æ›´æ–°
    setSearches(prev =>
      prev.map(s =>
        s.id === search.id
          ? { ...s, executionCount: s.executionCount + 1, lastExecuted: new Date() }
          : s
      )
    );
  };

  if (!isOpen) return null;

  return (
    <div className="saved-searches-panel">
      <div className="panel-header">
        <h3>ä¿å­˜æ¸ˆã¿æ¤œç´¢</h3>
        <div className="header-actions">
          <button onClick={() => setShowSaveDialog(true)}>
            + æ–°è¦ä¿å­˜
          </button>
          <button onClick={() => setShowManageDialog(true)}>
            âš™ ç®¡ç†
          </button>
          <button onClick={onClose}>Ã—</button>
        </div>
      </div>

      <div className="panel-content">
        {searches.length > 0 ? (
          <div className="search-list">
            {searches
              .filter(s => s.isPinned)
              .map(search => (
                <SavedSearchItem
                  key={search.id}
                  search={search}
                  onExecute={handleExecute}
                />
              ))}
          </div>
        ) : (
          <div className="no-searches">
            <p>ä¿å­˜æ¸ˆã¿æ¤œç´¢ãŒã‚ã‚Šã¾ã›ã‚“</p>
            <button onClick={() => setShowSaveDialog(true)}>
              æ¤œç´¢æ¡ä»¶ã‚’ä¿å­˜
            </button>
          </div>
        )}
      </div>

      {showSaveDialog && (
        <SaveSearchDialog
          onClose={() => setShowSaveDialog(false)}
          onSave={(search) => {
            setSearches(prev => [...prev, search]);
            setShowSaveDialog(false);
          }}
        />
      )}

      {showManageDialog && (
        <ManageSavedSearchesDialog
          searches={searches}
          onUpdate={setSearches}
          onClose={() => setShowManageDialog(false)}
        />
      )}
    </div>
  );
};

const SavedSearchItem: React.FC<{
  search: SavedSearch;
  onExecute: (search: SavedSearch) => void;
}> = ({ search, onExecute }) => {
  const queryDescription = formatSearchQuery(search.query);

  return (
    <div
      className="saved-search-item"
      onClick={() => onExecute(search)}
    >
      <div className="search-icon">{search.icon}</div>
      <div className="search-info">
        <div className="search-name">
          {search.isFavorite && <StarIcon size={14} />}
          {search.name}
        </div>
        <div className="search-query">{queryDescription}</div>
        <div className="search-meta">
          å®Ÿè¡Œå›æ•°: {search.executionCount}å›
        </div>
      </div>
    </div>
  );
};

const SaveSearchDialog: React.FC<{
  onClose: () => void;
  onSave: (search: SavedSearch) => void;
}> = ({ onClose, onSave }) => {
  const [name, setName] = useState('');
  const [icon, setIcon] = useState('ğŸ“š');
  const [isFavorite, setIsFavorite] = useState(false);
  const [isPinned, setIsPinned] = useState(true);

  const currentQuery = useCurrentSearchQuery();

  const handleSave = async () => {
    const search: SavedSearch = {
      id: generateId(),
      name,
      icon,
      query: currentQuery,
      isFavorite,
      isPinned,
      createdAt: new Date(),
      lastExecuted: null,
      executionCount: 0,
    };

    await window.electronAPI.saveSavedSearch(search);
    onSave(search);
  };

  return (
    <div className="dialog-overlay" onClick={onClose}>
      <div className="dialog save-search-dialog" onClick={(e) => e.stopPropagation()}>
        <div className="dialog-header">
          <h3>æ¤œç´¢æ¡ä»¶ã‚’ä¿å­˜</h3>
          <button onClick={onClose}>Ã—</button>
        </div>

        <div className="dialog-content">
          <div className="form-group">
            <label>æ¤œç´¢å</label>
            <input
              type="text"
              value={name}
              onChange={(e) => setName(e.target.value)}
              placeholder="ä¾‹: æœªèª­æ¼«ç”»"
              autoFocus
            />
          </div>

          <div className="current-query">
            <h4>ç¾åœ¨ã®æ¤œç´¢æ¡ä»¶:</h4>
            <div className="query-preview">
              {formatSearchQuery(currentQuery)}
            </div>
          </div>

          <div className="form-group">
            <label>
              <input
                type="checkbox"
                checked={isFavorite}
                onChange={(e) => setIsFavorite(e.target.checked)}
              />
              ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ 
            </label>
          </div>

          <div className="form-group">
            <label>
              <input
                type="checkbox"
                checked={isPinned}
                onChange={(e) => setIsPinned(e.target.checked)}
              />
              ã‚µã‚¤ãƒ‰ãƒãƒ¼ã«å›ºå®šè¡¨ç¤º
            </label>
          </div>

          <div className="form-group">
            <label>ã‚¢ã‚¤ã‚³ãƒ³</label>
            <select value={icon} onChange={(e) => setIcon(e.target.value)}>
              <option value="ğŸ“š">ğŸ“š æ›¸ç±</option>
              <option value="ğŸ¬">ğŸ¬ å‹•ç”»</option>
              <option value="ğŸ¨">ğŸ¨ ã‚¤ãƒ©ã‚¹ãƒˆ</option>
              <option value="ğŸ“·">ğŸ“· å†™çœŸ</option>
              <option value="ğŸµ">ğŸµ éŸ³æ¥½</option>
              <option value="â­">â­ ãŠæ°—ã«å…¥ã‚Š</option>
            </select>
          </div>
        </div>

        <div className="dialog-footer">
          <button onClick={onClose}>ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
          <button
            className="primary"
            onClick={handleSave}
            disabled={!name.trim()}
          >
            ä¿å­˜
          </button>
        </div>
      </div>
    </div>
  );
};
```

#### 2.6.3 ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°

```typescript
const formatSearchQuery = (query: SearchQuery): string => {
  const parts: string[] = [];

  // ã‚¿ã‚°
  if (query.tags.include.length > 0) {
    const tagNames = query.tags.include.map(id => getTagName(id));
    parts.push(`ã‚¿ã‚°: ${tagNames.join(', ')}`);
  }

  // ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼
  if (query.fileTypes.length > 0) {
    parts.push(`å½¢å¼: ${query.fileTypes.join(', ')}`);
  }

  // ãƒšãƒ¼ã‚¸æ•°
  if (query.archivePageRange) {
    const [min, max] = query.archivePageRange;
    parts.push(`ãƒšãƒ¼ã‚¸æ•°: ${min}ã€œ${max}`);
  }

  // é•·ã•
  if (query.durationRange) {
    const [min, max] = query.durationRange;
    parts.push(`é•·ã•: ${formatDuration(min)}ã€œ${formatDuration(max)}`);
  }

  return parts.join(', ');
};
```

---

## 3. ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©

### 3.1 ã‚µãƒ ãƒã‚¤ãƒ«é€²æ—UI

```css
.thumbnail-progress-indicator {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 4px 12px;
  background: var(--bg-secondary);
  border-radius: var(--radius-sm);
  cursor: pointer;
  font-size: 13px;
  transition: background 0.2s;
}

.thumbnail-progress-indicator:hover {
  background: var(--bg-hover);
}

.thumbnail-progress-detail {
  position: fixed;
  bottom: 48px;
  right: 16px;
  width: 400px;
  background: var(--bg-paper);
  border: 1px solid var(--divider);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-xl);
  z-index: 1000;
}

.progress-bar {
  height: 8px;
  background: var(--bg-secondary);
  border-radius: var(--radius-full);
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: var(--primary-main);
  transition: width 0.3s ease;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 8px;
  margin-top: 16px;
}

.stat-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 8px;
  background: var(--bg-secondary);
  border-radius: var(--radius-sm);
}

.stat-item .value.success {
  color: var(--success);
}

.stat-item .value.error {
  color: var(--error);
}
```

### 3.2 ä¿å­˜æ¸ˆã¿æ¤œç´¢UI

```css
.saved-search-item {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 12px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: background 0.2s;
}

.saved-search-item:hover {
  background: var(--bg-hover);
}

.search-icon {
  font-size: 24px;
  flex-shrink: 0;
}

.search-info {
  flex: 1;
  min-width: 0;
}

.search-name {
  display: flex;
  align-items: center;
  gap: 4px;
  font-weight: 600;
  margin-bottom: 4px;
}

.search-query {
  font-size: 13px;
  color: var(--text-secondary);
  margin-bottom: 4px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.search-meta {
  font-size: 12px;
  color: var(--text-tertiary);
}
```
