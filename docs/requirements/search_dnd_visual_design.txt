# æ¤œç´¢çµæœãƒã‚¤ãƒ©ã‚¤ãƒˆãƒ»D&Dãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ è¨­è¨ˆæ›¸

## ç›®æ¬¡

1. [æ¤œç´¢çµæœãƒã‚¤ãƒ©ã‚¤ãƒˆ](#1-æ¤œç´¢çµæœãƒã‚¤ãƒ©ã‚¤ãƒˆ)
2. [ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯](#2-ãƒ‰ãƒ©ãƒƒã‚°ãƒ‰ãƒ­ãƒƒãƒ—ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯)

---

## 1. æ¤œç´¢çµæœãƒã‚¤ãƒ©ã‚¤ãƒˆ

### 1.1 æ¦‚è¦

æ¤œç´¢èªå¥ã«ä¸€è‡´ã™ã‚‹éƒ¨åˆ†ã‚’ãƒ•ã‚¡ã‚¤ãƒ«åãƒ»ã‚¿ã‚°ãƒ»ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å†…ã§è¦–è¦šçš„ã«å¼·èª¿è¡¨ç¤ºã—ã€æ¤œç´¢çµæœã®è¦–èªæ€§ã‚’å‘ä¸Šã•ã›ã‚‹ã€‚

### 1.2 ãƒã‚¤ãƒ©ã‚¤ãƒˆå¯¾è±¡

#### 1.2.1 ãƒ•ã‚¡ã‚¤ãƒ«å

```txt
æ¤œç´¢: "manga"

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“š <manga>_vol1.zip     â”‚ â† "manga"ãŒãƒã‚¤ãƒ©ã‚¤ãƒˆ
â”‚ 50ãƒšãƒ¼ã‚¸ 12.3MB          â”‚
â”‚ ğŸ·ï¸æ¼«ç”» ğŸ·ï¸å®Œçµ           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¬ video_<manga>.mp4    â”‚
â”‚ 45:23 523MB             â”‚
â”‚ ğŸ·ï¸å‹•ç”»                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 1.2.2 ã‚¿ã‚°å

```txt
æ¤œç´¢: "ã‚¤ãƒ©ã‚¹ãƒˆ"

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“š artbook_001.zip      â”‚
â”‚ 120ãƒšãƒ¼ã‚¸ 45.6MB         â”‚
â”‚ ğŸ·ï¸<ã‚¤ãƒ©ã‚¹ãƒˆ> ğŸ·ï¸é«˜è§£åƒåº¦ â”‚ â† "ã‚¤ãƒ©ã‚¹ãƒˆ"ãŒãƒã‚¤ãƒ©ã‚¤ãƒˆ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 1.2.3 ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆè©³ç´°è¡¨ç¤ºæ™‚ï¼‰

```txt
æ¤œç´¢: "Canon"

ãƒ•ã‚¡ã‚¤ãƒ«å: photo_001.jpg
EXIFæƒ…å ±:
  ãƒ¡ãƒ¼ã‚«ãƒ¼: <Canon>        â† ãƒã‚¤ãƒ©ã‚¤ãƒˆ
  ãƒ¢ãƒ‡ãƒ«: <Canon> EOS 5D   â† ãƒã‚¤ãƒ©ã‚¤ãƒˆ
  æ’®å½±æ—¥æ™‚: 2024-10-01
```

### 1.3 ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚¹ã‚¿ã‚¤ãƒ«

#### 1.3.1 åŸºæœ¬ãƒã‚¤ãƒ©ã‚¤ãƒˆ

```typescript
<span className="highlight-match">manga</span>
```

**CSS:**

```css
.highlight-match {
  background-color: rgba(255, 235, 59, 0.4); /* é»„è‰²åŠé€æ˜ */
  color: inherit;
  font-weight: 600;
  padding: 2px 0;
  border-radius: 2px;
}

/* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ */
.dark .highlight-match {
  background-color: rgba(255, 193, 7, 0.3);
}
```

#### 1.3.2 ç¾åœ¨ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ä¸­ã®ãƒãƒƒãƒ

```css
.highlight-match.current {
  background-color: rgba(255, 152, 0, 0.6);
  outline: 2px solid var(--primary-main);
}
```

#### 1.3.3 è¤‡æ•°ãƒãƒƒãƒã®è‰²åˆ†ã‘

```typescript
// è¤‡æ•°æ¤œç´¢èªå¥ã®å ´åˆã¯è‰²ã‚’å¤‰ãˆã‚‹
<span className="highlight-match color-1">manga</span>
<span className="highlight-match color-2">comic</span>
```

```css
.highlight-match.color-1 {
  background-color: rgba(255, 235, 59, 0.4); /* é»„è‰² */
}

.highlight-match.color-2 {
  background-color: rgba(76, 175, 80, 0.4); /* ç·‘è‰² */
}

.highlight-match.color-3 {
  background-color: rgba(33, 150, 243, 0.4); /* é’è‰² */
}
```

### 1.4 å®Ÿè£…

#### 1.4.1 ãƒã‚¤ãƒ©ã‚¤ãƒˆé–¢æ•°

```typescript
/**
 * ãƒ†ã‚­ã‚¹ãƒˆå†…ã®æ¤œç´¢èªå¥ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
 */
const highlightText = (
  text: string,
  searchTerms: string[],
  currentMatchIndex?: number
): React.ReactNode => {
  if (searchTerms.length === 0) return text;

  // ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†
  const escapedTerms = searchTerms.map(term =>
    term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')
  );

  // æ­£è¦è¡¨ç¾ä½œæˆï¼ˆå¤§æ–‡å­—å°æ–‡å­—åŒºåˆ¥ãªã—ï¼‰
  const pattern = new RegExp(`(${escapedTerms.join('|')})`, 'gi');
  const parts = text.split(pattern);

  let matchIndex = 0;

  return parts.map((part, index) => {
    const isMatch = searchTerms.some(term =>
      part.toLowerCase() === term.toLowerCase()
    );

    if (isMatch) {
      const colorIndex = searchTerms.findIndex(term =>
        part.toLowerCase() === term.toLowerCase()
      );
      const isCurrent = currentMatchIndex === matchIndex;
      matchIndex++;

      return (
        <span
          key={index}
          className={`highlight-match color-${colorIndex + 1} ${isCurrent ? 'current' : ''}`}
        >
          {part}
        </span>
      );
    }

    return part;
  });
};
```

#### 1.4.2 ä½¿ç”¨ä¾‹

```typescript
const FileCard: React.FC<{
  file: FileInfo;
  searchTerms: string[];
}> = ({ file, searchTerms }) => {
  return (
    <div className="file-card">
      <div className="file-name">
        {highlightText(file.file_name, searchTerms)}
      </div>
      
      <div className="file-tags">
        {file.tags.map(tag => (
          <span key={tag.id} className="tag-chip">
            {highlightText(tag.tag_name, searchTerms)}
          </span>
        ))}
      </div>
    </div>
  );
};
```

#### 1.4.3 ãƒãƒƒãƒãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³

```typescript
const SearchMatchNavigation: React.FC<{
  totalMatches: number;
  currentMatch: number;
  onNext: () => void;
  onPrev: () => void;
}> = ({ totalMatches, currentMatch, onNext, onPrev }) => {
  if (totalMatches === 0) return null;

  return (
    <div className="match-navigation">
      <span className="match-count">
        {currentMatch + 1} / {totalMatches} ä»¶
      </span>
      <button
        onClick={onPrev}
        disabled={currentMatch === 0}
        aria-label="å‰ã®ãƒãƒƒãƒ"
      >
        â–²
      </button>
      <button
        onClick={onNext}
        disabled={currentMatch === totalMatches - 1}
        aria-label="æ¬¡ã®ãƒãƒƒãƒ"
      >
        â–¼
      </button>
    </div>
  );
};
```

### 1.5 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

#### 1.5.1 ãƒ¡ãƒ¢åŒ–

```typescript
const MemoizedFileCard = React.memo<FileCardProps>(
  ({ file, searchTerms }) => {
    const highlightedName = useMemo(
      () => highlightText(file.file_name, searchTerms),
      [file.file_name, searchTerms]
    );

    return (
      <div className="file-card">
        <div className="file-name">{highlightedName}</div>
      </div>
    );
  },
  (prev, next) => {
    return (
      prev.file.id === next.file.id &&
      prev.searchTerms.join(',') === next.searchTerms.join(',')
    );
  }
);
```

#### 1.5.2 ä»®æƒ³ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã¨ã®é€£æº

```typescript
import { FixedSizeList } from 'react-window';

const VirtualizedSearchResults: React.FC<{
  files: FileInfo[];
  searchTerms: string[];
}> = ({ files, searchTerms }) => {
  const Row = ({ index, style }: { index: number; style: React.CSSProperties }) => (
    <div style={style}>
      <MemoizedFileCard
        file={files[index]}
        searchTerms={searchTerms}
      />
    </div>
  );

  return (
    <FixedSizeList
      height={600}
      itemCount={files.length}
      itemSize={120}
      width="100%"
    >
      {Row}
    </FixedSizeList>
  );
};
```

---

## 2. ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯

### 2.1 æ¦‚è¦

ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ã‚¿ã‚°ã®ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—æ“ä½œæ™‚ã«ã€è¦–è¦šçš„ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’æä¾›ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç¾åœ¨ã®çŠ¶æ…‹ã‚’æ˜ç¢ºã«ä¼ãˆã‚‹ã€‚

### 2.2 ãƒ‰ãƒ©ãƒƒã‚°çŠ¶æ…‹ã®ç¨®é¡

#### 2.2.1 ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹

```txt
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“š manga_vol1.zip       â”‚ â† å…ƒã®ä½ç½®ï¼ˆåŠé€æ˜ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â†“ ã‚«ãƒ¼ã‚½ãƒ«ã«è¿½å¾“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“š manga_vol1.zip       â”‚ â† ãƒ‰ãƒ©ãƒƒã‚°ã‚´ãƒ¼ã‚¹ãƒˆ
â”‚ + 2ä»¶ã®ãƒ•ã‚¡ã‚¤ãƒ«          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.2.2 æœ‰åŠ¹ãªãƒ‰ãƒ­ãƒƒãƒ—ã‚¿ãƒ¼ã‚²ãƒƒãƒˆä¸Š

```txt
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â˜‘ ğŸ”µ æ¼«ç”» (87)      [â­]  â”‚ â† é’ã„èƒŒæ™¯ã€ç‚¹ç·šãƒœãƒ¼ãƒ€ãƒ¼
â”‚   ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦ã‚¿ã‚°ã‚’è¿½åŠ    â”‚ â† ãƒ’ãƒ³ãƒˆãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.2.3 ç„¡åŠ¹ãªãƒ‰ãƒ­ãƒƒãƒ—ã‚¿ãƒ¼ã‚²ãƒƒãƒˆä¸Š

```txt
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â˜ ğŸ”´ å‹•ç”» (24)            â”‚ â† èµ¤ã„èƒŒæ™¯ã€ç¦æ­¢ã‚¢ã‚¤ã‚³ãƒ³
â”‚   ã“ã®ã‚¿ã‚°ã«ã¯è¿½åŠ ã§ãã¾ã›ã‚“â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.2.4 ãƒ‰ãƒ­ãƒƒãƒ—å®Œäº†ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

```txt
ãƒ•ã‚¡ã‚¤ãƒ« â†’ ã‚¿ã‚°

[ãƒ•ã‚¡ã‚¤ãƒ«] â”â”â”â”â”â”â”> [ã‚¿ã‚°]
           ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«åŠ¹æœ
           
[ã‚¿ã‚°] âœ“ è¿½åŠ å®Œäº†
  â†“
 æ‹¡å¤§â†’ç¸®å°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
```

### 2.3 ãƒ‰ãƒ©ãƒƒã‚°ã‚´ãƒ¼ã‚¹ãƒˆã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

#### 2.3.1 å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«

```txt
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“š manga_vol1.zip           â”‚
â”‚ 50ãƒšãƒ¼ã‚¸ | 12.3MB            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.3.2 è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«

```txt
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“š manga_vol1.zip           â”‚
â”‚ + 4ä»¶ã®ãƒ•ã‚¡ã‚¤ãƒ«              â”‚
â”‚ åˆè¨ˆ: 67.8MB                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.3.3 ã‚¿ã‚°ãƒ‰ãƒ©ãƒƒã‚°

```txt
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”µ æ¼«ç”» (87)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 å®Ÿè£…

#### 2.4.1 ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹

```typescript
const useDragAndDrop = () => {
  const [isDragging, setIsDragging] = useState(false);
  const [draggedItems, setDraggedItems] = useState<FileInfo[]>([]);
  const [dropTarget, setDropTarget] = useState<string | null>(null);

  const handleDragStart = (
    e: React.DragEvent,
    items: FileInfo[]
  ) => {
    setIsDragging(true);
    setDraggedItems(items);

    // ãƒ‡ãƒ¼ã‚¿è»¢é€è¨­å®š
    e.dataTransfer.effectAllowed = 'copy';
    e.dataTransfer.setData('application/json', JSON.stringify({
      type: 'files',
      items: items.map(item => item.id),
    }));

    // ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ©ãƒƒã‚°ã‚¤ãƒ¡ãƒ¼ã‚¸
    const dragGhost = createDragGhost(items);
    document.body.appendChild(dragGhost);
    e.dataTransfer.setDragImage(dragGhost, 20, 20);

    // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
    setTimeout(() => {
      document.body.removeChild(dragGhost);
    }, 0);
  };

  const handleDragEnd = () => {
    setIsDragging(false);
    setDraggedItems([]);
    setDropTarget(null);
  };

  return {
    isDragging,
    draggedItems,
    dropTarget,
    handleDragStart,
    handleDragEnd,
    setDropTarget,
  };
};

const createDragGhost = (items: FileInfo[]): HTMLElement => {
  const ghost = document.createElement('div');
  ghost.className = 'drag-ghost';
  
  if (items.length === 1) {
    ghost.innerHTML = `
      <div class="drag-ghost-content">
        <span class="file-icon">${getFileIcon(items[0])}</span>
        <span class="file-name">${items[0].file_name}</span>
      </div>
    `;
  } else {
    const totalSize = items.reduce((sum, item) => sum + item.file_size, 0);
    ghost.innerHTML = `
      <div class="drag-ghost-content">
        <span class="file-icon">${getFileIcon(items[0])}</span>
        <span class="file-name">${items[0].file_name}</span>
        <div class="additional-count">+ ${items.length - 1}ä»¶ã®ãƒ•ã‚¡ã‚¤ãƒ«</div>
        <div class="total-size">åˆè¨ˆ: ${formatFileSize(totalSize)}</div>
      </div>
    `;
  }

  ghost.style.position = 'absolute';
  ghost.style.top = '-9999px';
  ghost.style.left = '-9999px';
  ghost.style.opacity = '0.8';

  return ghost;
};
```

#### 2.4.2 ãƒ‰ãƒ­ãƒƒãƒ—ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ

```typescript
const TagDropTarget: React.FC<{
  tag: Tag;
  onDrop: (tagId: number, fileIds: number[]) => void;
}> = ({ tag, onDrop }) => {
  const [isOver, setIsOver] = useState(false);
  const [canDrop, setCanDrop] = useState(true);

  const handleDragOver = (e: React.DragEvent) => {
    e.preventDefault();
    e.dataTransfer.dropEffect = canDrop ? 'copy' : 'none';
  };

  const handleDragEnter = (e: React.DragEvent) => {
    e.preventDefault();
    
    // ãƒ‰ãƒ­ãƒƒãƒ—å¯å¦åˆ¤å®š
    const data = e.dataTransfer.getData('application/json');
    if (data) {
      const { type } = JSON.parse(data);
      setCanDrop(type === 'files');
    }

    setIsOver(true);
  };

  const handleDragLeave = () => {
    setIsOver(false);
  };

  const handleDrop = (e: React.DragEvent) => {
    e.preventDefault();
    setIsOver(false);

    if (!canDrop) return;

    try {
      const data = JSON.parse(e.dataTransfer.getData('application/json'));
      if (data.type === 'files') {
        onDrop(tag.id, data.items);
        
        // ãƒ‰ãƒ­ãƒƒãƒ—æˆåŠŸã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        playDropSuccessAnimation(e.currentTarget as HTMLElement);
      }
    } catch (error) {
      console.error('Drop failed:', error);
    }
  };

  return (
    <div
      className={`tag-item drop-target ${isOver ? 'drag-over' : ''} ${!canDrop ? 'invalid' : ''}`}
      onDragOver={handleDragOver}
      onDragEnter={handleDragEnter}
      onDragLeave={handleDragLeave}
      onDrop={handleDrop}
    >
      <div className="tag-color" style={{ backgroundColor: tag.color }} />
      <span className="tag-name">{tag.tag_name}</span>
      <span className="tag-count">({tag.usage_count})</span>

      {isOver && (
        <div className="drop-hint">
          {canDrop ? (
            <>
              <PlusIcon size={16} />
              ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦ã‚¿ã‚°ã‚’è¿½åŠ 
            </>
          ) : (
            <>
              <XIcon size={16} />
              ã“ã®ã‚¿ã‚°ã«ã¯è¿½åŠ ã§ãã¾ã›ã‚“
            </>
          )}
        </div>
      )}
    </div>
  );
};
```

#### 2.4.3 ãƒ‰ãƒ­ãƒƒãƒ—æˆåŠŸã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

```typescript
const playDropSuccessAnimation = (element: HTMLElement) => {
  // ãƒ‘ãƒ«ã‚¹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
  element.classList.add('drop-success');
  
  // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«åŠ¹æœ
  createParticles(element);

  setTimeout(() => {
    element.classList.remove('drop-success');
  }, 600);
};

const createParticles = (element: HTMLElement) => {
  const rect = element.getBoundingClientRect();
  const centerX = rect.left + rect.width / 2;
  const centerY = rect.top + rect.height / 2;

  for (let i = 0; i < 8; i++) {
    const particle = document.createElement('div');
    particle.className = 'drop-particle';
    
    const angle = (Math.PI * 2 * i) / 8;
    const distance = 40;
    const x = centerX + Math.cos(angle) * distance;
    const y = centerY + Math.sin(angle) * distance;

    particle.style.left = `${centerX}px`;
    particle.style.top = `${centerY}px`;
    particle.style.setProperty('--end-x', `${x}px`);
    particle.style.setProperty('--end-y', `${y}px`);

    document.body.appendChild(particle);

    setTimeout(() => {
      document.body.removeChild(particle);
    }, 500);
  }
};
```

#### 2.4.4 å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‰ãƒ­ãƒƒãƒ—

```typescript
const FileDropZone: React.FC<{
  onFileDrop: (files: string[]) => void;
}> = ({ onFileDrop }) => {
  const [isDragOver, setIsDragOver] = useState(false);

  const handleDragOver = (e: React.DragEvent) => {
    e.preventDefault();
    e.dataTransfer.dropEffect = 'copy';
  };

  const handleDragEnter = (e: React.DragEvent) => {
    e.preventDefault();
    
    // å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã©ã†ã‹åˆ¤å®š
    if (e.dataTransfer.types.includes('Files')) {
      setIsDragOver(true);
    }
  };

  const handleDragLeave = (e: React.DragEvent) => {
    // å­è¦ç´ ã¸ã®ç§»å‹•ã¯ç„¡è¦–
    if (e.currentTarget.contains(e.relatedTarget as Node)) {
      return;
    }
    setIsDragOver(false);
  };

  const handleDrop = (e: React.DragEvent) => {
    e.preventDefault();
    setIsDragOver(false);

    const files = Array.from(e.dataTransfer.files);
    const paths = files.map(f => f.path);

    if (paths.length > 0) {
      onFileDrop(paths);
    }
  };

  return (
    <div
      className={`file-drop-zone ${isDragOver ? 'active' : ''}`}
      onDragOver={handleDragOver}
      onDragEnter={handleDragEnter}
      onDragLeave={handleDragLeave}
      onDrop={handleDrop}
    >
      {isDragOver ? (
        <div className="drop-overlay">
          <UploadIcon size={64} />
          <h3>ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ­ãƒƒãƒ—</h3>
          <p>ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ </p>
        </div>
      ) : (
        <div className="drop-hint-text">
          ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
        </div>
      )}
    </div>
  );
};
```

### 2.5 ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©

```css
/* ãƒ‰ãƒ©ãƒƒã‚°ã‚´ãƒ¼ã‚¹ãƒˆ */
.drag-ghost {
  background: var(--bg-paper);
  border: 2px solid var(--primary-main);
  border-radius: var(--radius-md);
  padding: 12px 16px;
  box-shadow: var(--shadow-xl);
  pointer-events: none;
  min-width: 200px;
}

.drag-ghost-content {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.additional-count {
  font-size: 13px;
  color: var(--text-secondary);
  font-weight: 600;
}

/* ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®å…ƒè¦ç´  */
.dragging {
  opacity: 0.5;
  cursor: grabbing;
}

/* ãƒ‰ãƒ­ãƒƒãƒ—ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ */
.drop-target.drag-over {
  background: rgba(25, 118, 210, 0.1);
  border: 2px dashed var(--primary-main);
  animation: dragOverPulse 1s ease-in-out infinite;
}

.drop-target.drag-over.invalid {
  background: rgba(244, 67, 54, 0.1);
  border-color: var(--error);
}

@keyframes dragOverPulse {
  0%, 100% {
    background-color: rgba(25, 118, 210, 0.05);
  }
  50% {
    background-color: rgba(25, 118, 210, 0.15);
  }
}

.drop-hint {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  background: var(--primary-main);
  color: white;
  border-radius: var(--radius-sm);
  font-size: 13px;
  font-weight: 600;
  white-space: nowrap;
  pointer-events: none;
  z-index: 10;
}

.drop-target.invalid .drop-hint {
  background: var(--error);
}

/* ãƒ‰ãƒ­ãƒƒãƒ—æˆåŠŸã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
.drop-success {
  animation: dropSuccess 0.6s ease-out;
}

@keyframes dropSuccess {
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.05);
    box-shadow: 0 0 0 8px rgba(76, 175, 80, 0.3);
  }
  100% {
    transform: scale(1);
    box-shadow: 0 0 0 0 rgba(76, 175, 80, 0);
  }
}

/* ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ« */
.drop-particle {
  position: fixed;
  width: 8px;
  height: 8px;
  background: var(--primary-main);
  border-radius: 50%;
  pointer-events: none;
  animation: particleFly 0.5s ease-out forwards;
  z-index: 9999;
}

@keyframes particleFly {
  0% {
    transform: translate(0, 0) scale(1);
    opacity: 1;
  }
  100% {
    transform: translate(
      calc(var(--end-x) - 50%),
      calc(var(--end-y) - 50%)
    ) scale(0);
    opacity: 0;
  }
}

/* å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ */
.file-drop-zone {
  position: relative;
  min-height: 200px;
  border: 2px dashed var(--divider);
  border-radius: var(--radius-lg);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s;
}

.file-drop-zone.active {
  border-color: var(--primary-main);
  background: rgba(25, 118, 210, 0.05);
}

.drop-overlay {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 16px;
  color: var(--primary-main);
  animation: fadeIn 0.2s;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

.drop-hint-text {
  color: var(--text-tertiary);
  font-size: 14px;
}
```

### 2.6 ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å¯¾å¿œ

```typescript
// ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã§ã®ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ä»£æ›¿
const KeyboardDragDrop: React.FC<{
  items: FileInfo[];
  onTagAssign: (tagId: number) => void;
}> = ({ items, onTagAssign }) => {
  const [isSelecting, setIsSelecting] = useState(false);

  const handleKeyDown = (e: KeyboardEvent) => {
    if (e.key === 't' && e.ctrlKey) {
      e.preventDefault();
      setIsSelecting(true);
    }
  };

  return (
    <>
      {isSelecting && (
        <TagSelectionDialog
          items={items}
          onSelect={onTagAssign}
          onClose={() => setIsSelecting(false)}
        />
      )}
    </>
  );
};
```

---

## 3. çµ±åˆä½¿ç”¨ä¾‹

```typescript
const MainScreen: React.FC = () => {
  const [searchTerms, setSearchTerms] = useState<string[]>([]);
  const { isDragging, draggedItems, handleDragStart, handleDragEnd } = useDragAndDrop();

  return (
    <div className={`main-screen ${isDragging ? 'dragging-active' : ''}`}>
      <Sidebar>
        <TagList
          onDrop={(tagId, fileIds) => {
            addTagsToFiles(fileIds, [tagId]);
            showNotification({
              type: 'success',
              message: `${fileIds.length}ä»¶ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¿ã‚°ã‚’è¿½åŠ ã—ã¾ã—ãŸ`,
            });
          }}
        />
      </Sidebar>

      <FileListArea>
        <FileGrid
          files={files}
          searchTerms={searchTerms}
          onDragStart={handleDragStart}
          onDragEnd={handleDragEnd}
        />
      </FileListArea>

      <FileDropZone
        onFileDrop={(paths) => {
          openFileAddDialog(paths);
        }}
      />
    </div>
  );
};
```
